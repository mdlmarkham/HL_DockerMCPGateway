name: Docker Compose Validation

on:
  push:
    branches: [ main, develop ]
  pull_request:
    branches: [ main ]

jobs:
  validate:
    runs-on: ubuntu-latest
    
    steps:
    - name: Checkout code
      uses: actions/checkout@v4
    
    - name: Set up Docker Buildx
      uses: docker/setup-buildx-action@v3
    
    - name: Validate compose file
      run: |
        docker compose config
        docker compose config --quiet
    
    - name: Check for security issues in compose
      run: |
        # Check for exposed sensitive ports
        if grep -q "0.0.0.0" compose.yaml; then
          echo "Warning: Found 0.0.0.0 binding in compose.yaml"
          echo "Consider restricting to specific interfaces for production"
        fi
    
    - name: Lint Markdown files
      uses: DavidAnson/markdownlint-cli2-action@v15
      with:
        globs: '**/*.md'
        config: '.markdownlint.json'
        continue-on-error: true
